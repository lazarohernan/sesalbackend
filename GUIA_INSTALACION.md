# üöÄ Gu√≠a de Instalaci√≥n - BI SESAL
## Sistema de Business Intelligence para Servidor Gubernamental

Esta gu√≠a te ayudar√° a instalar el sistema paso a paso de forma sencilla.

---

## üìã √çndice R√°pido
1. [¬øQu√© necesitas antes de empezar?](#1-qu√©-necesitas-antes-de-empezar)
2. [Preparar los archivos en tu computadora](#2-preparar-los-archivos-en-tu-computadora)
3. [Configurar el servidor Linux](#3-configurar-el-servidor-linux)
4. [Instalar la base de datos](#4-instalar-la-base-de-datos)
5. [Instalar el sistema](#5-instalar-el-sistema)
6. [Configurar el dominio web](#6-configurar-el-dominio-web)
7. [Activar los certificados de seguridad](#7-activar-los-certificados-de-seguridad)
8. [Verificar que todo funciona](#8-verificar-que-todo-funciona)

---

## 1. ¬øQu√© necesitas antes de empezar?

### En el servidor:
- ‚úÖ Un servidor Linux (Ubuntu 22.04 o similar)
- ‚úÖ Acceso como administrador (usuario con sudo)
- ‚úÖ Dos nombres de dominio:
  - `dashboard.tu-institucion.gob.hn` ‚Üí Para el tablero visual
  - `api.tu-institucion.gob.hn` ‚Üí Para los datos

### Recursos m√≠nimos recomendados:
- üñ•Ô∏è **Procesador:** 4 n√∫cleos
- üíæ **Memoria RAM:** 8 GB
- üíΩ **Disco:** 100 GB

---

## 2. Preparar los archivos en tu computadora

### Paso 2.1: Exportar la base de datos

Abre la terminal en tu Mac y ejecuta:

```bash
cd "/Users/lazarohernan/Desktop/SISTEMA ATA/BI_SESAL"

# Exportar la base de datos
mysqldump -u root -p sesal_historico > base-datos.sql

# Comprimir para transferir m√°s r√°pido
gzip base-datos.sql
```

Te pedir√° la contrase√±a de MySQL. Al terminar, tendr√°s un archivo llamado `base-datos.sql.gz`

### Paso 2.2: Empaquetar el sistema

En la misma terminal:

```bash
# Crear un paquete con todo el sistema
tar -czf sistema-completo.tar.gz backend webapp-BISESAL nginx-backend.conf nginx-frontend.conf

# Ahora tienes 2 archivos listos para transferir:
# 1. base-datos.sql.gz (la base de datos)
# 2. sistema-completo.tar.gz (el sistema completo)
```

### Paso 2.3: Transferir al servidor

Transfiere los 2 archivos al servidor usando alguna de estas opciones:

**Opci√≥n A - Usando terminal:**
```bash
# Cambiar "usuario" e "ip-del-servidor" por los datos reales
scp base-datos.sql.gz usuario@ip-del-servidor:/home/usuario/
scp sistema-completo.tar.gz usuario@ip-del-servidor:/home/usuario/
```

**Opci√≥n B - Usando FileZilla o WinSCP:**
- Conectarte por SFTP al servidor
- Subir los 2 archivos a la carpeta `/home/usuario/`

---

## 3. Configurar el servidor Linux

Ahora con√©ctate al servidor y sigue estos pasos.

### Paso 3.1: Actualizar el sistema

```bash
# Actualizar la lista de software disponible
sudo apt update

# Instalar las actualizaciones
sudo apt upgrade -y
```

### Paso 3.2: Instalar MySQL (base de datos)

```bash
# Instalar MySQL
sudo apt install mysql-server -y

# Configurar seguridad
sudo mysql_secure_installation
```

Responde as√≠:
- **¬øValidar contrase√±as?** ‚Üí Presiona `Enter` (No)
- **¬øCambiar contrase√±a de root?** ‚Üí Escribe `y` y crea una contrase√±a segura (gu√°rdala bien)
- **¬øEliminar usuarios an√≥nimos?** ‚Üí `y`
- **¬øDeshabilitar acceso remoto de root?** ‚Üí `y`
- **¬øEliminar base de datos de prueba?** ‚Üí `y`
- **¬øRecargar privilegios?** ‚Üí `y`

### Paso 3.3: Instalar Node.js (motor del sistema)

```bash
# Descargar e instalar Node.js versi√≥n 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Verificar que se instal√≥ correctamente (debe mostrar v20.x.x)
node --version
```

### Paso 3.4: Instalar PM2 (gestor de procesos)

```bash
# PM2 mantiene el sistema funcionando 24/7
sudo npm install -g pm2
```

### Paso 3.5: Instalar Nginx (servidor web)

```bash
# Instalar Nginx
sudo apt install nginx -y

# Iniciarlo
sudo systemctl start nginx
sudo systemctl enable nginx
```

### Paso 3.6: Instalar Certbot (certificados de seguridad HTTPS)

```bash
sudo apt install certbot python3-certbot-nginx -y
```

---

## 4. Instalar la base de datos

### Paso 4.1: Crear el usuario y la base de datos

```bash
# Entrar a MySQL
sudo mysql

# Dentro de MySQL, ejecutar estos comandos uno por uno:
```

```sql
CREATE DATABASE sesal_historico CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE USER 'bisesal_user'@'localhost' IDENTIFIED BY 'MiPasswordSeguro2024';

GRANT ALL PRIVILEGES ON sesal_historico.* TO 'bisesal_user'@'localhost';

FLUSH PRIVILEGES;

EXIT;
```

‚ö†Ô∏è **IMPORTANTE:** Cambia `MiPasswordSeguro2024` por una contrase√±a segura y gu√°rdala. La necesitar√°s despu√©s.

### Paso 4.2: Importar los datos

```bash
# Descomprimir el archivo
gunzip base-datos.sql.gz

# Importar a MySQL (usa la contrase√±a que creaste)
mysql -u bisesal_user -p sesal_historico < base-datos.sql

# Verificar que se import√≥ correctamente
mysql -u bisesal_user -p sesal_historico -e "SHOW TABLES;"
```

Debe mostrar una lista de tablas. Si ves tablas, ¬°todo est√° bien! ‚úÖ

---

## 5. Instalar el sistema

### Paso 5.1: Crear la carpeta del sistema

```bash
# Crear carpeta
sudo mkdir -p /var/www/bisesal

# Darte permisos sobre ella
sudo chown -R $USER:$USER /var/www/bisesal

# Ir a la carpeta
cd /var/www/bisesal
```

### Paso 5.2: Descomprimir el sistema

```bash
# Descomprimir (cambiar la ruta si subiste el archivo a otro lugar)
tar -xzf ~/sistema-completo.tar.gz
```

### Paso 5.3: Configurar el BACKEND (servidor de datos)

```bash
# Ir a la carpeta del backend
cd /var/www/bisesal/backend

# Crear el archivo de configuraci√≥n
nano .env
```

Se abrir√° un editor. Escribe esto (ajusta los valores):

```env
NODE_ENV=production
PORT=4000

MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=bisesal_user
MYSQL_PASSWORD=MiPasswordSeguro2024
MYSQL_DATABASE=sesal_historico

CORS_ORIGINS=*
```

‚ö†Ô∏è **Cambia `MiPasswordSeguro2024`** por la contrase√±a que creaste en el paso 4.1

Para guardar: `Ctrl + O`, `Enter`, `Ctrl + X`

```bash
# Instalar dependencias
npm install --production

# Crear carpeta para logs
mkdir -p logs

# Iniciar el sistema con PM2
pm2 start ecosystem.config.js

# Verificar que est√° corriendo
pm2 status
```

Debes ver algo como:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id  ‚îÇ name             ‚îÇ status  ‚îÇ restart ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0   ‚îÇ bisesal-backend  ‚îÇ online  ‚îÇ 0       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

Si dice `online`, ¬°est√° funcionando! ‚úÖ

```bash
# Hacer que se inicie autom√°ticamente al reiniciar el servidor
pm2 save
pm2 startup
# Ejecutar el comando que te muestre (copiarlo y pegarlo)
```

### Paso 5.4: Configurar el FRONTEND (tablero visual)

```bash
# Ir a la carpeta del frontend
cd /var/www/bisesal/webapp-BISESAL

# Crear el archivo de configuraci√≥n
nano .env.production
```

Escribe esto (ajusta tu dominio real):

```env
VITE_API_URL=https://api.tu-institucion.gob.hn
```

‚ö†Ô∏è **Cambia `api.tu-institucion.gob.hn`** por tu dominio real del API

Para guardar: `Ctrl + O`, `Enter`, `Ctrl + X`

```bash
# Instalar dependencias
npm install

# Compilar para producci√≥n (esto toma unos minutos)
npm run build
```

Al terminar, ver√°s una carpeta llamada `dist` con todos los archivos listos.

---

## 6. Configurar el dominio web

### Paso 6.1: Configurar el dominio del API

```bash
# Editar el archivo de configuraci√≥n del API
cd /var/www/bisesal
nano nginx-backend.conf
```

En la **l√≠nea 7**, cambia:
```
server_name api.tu-dominio-gobierno.gob.hn;
```
Por tu dominio real, ejemplo:
```
server_name api.salud.gob.hn;
```

Guardar: `Ctrl + O`, `Enter`, `Ctrl + X`

```bash
# Copiar a la carpeta de Nginx
sudo cp nginx-backend.conf /etc/nginx/sites-available/bisesal-backend

# Activarla
sudo ln -s /etc/nginx/sites-available/bisesal-backend /etc/nginx/sites-enabled/
```

### Paso 6.2: Configurar el dominio del Dashboard

```bash
# Editar el archivo de configuraci√≥n del dashboard
nano nginx-frontend.conf
```

En la **l√≠nea 7**, cambia:
```
server_name dashboard.tu-dominio-gobierno.gob.hn;
```
Por tu dominio real, ejemplo:
```
server_name dashboard.salud.gob.hn;
```

Guardar: `Ctrl + O`, `Enter`, `Ctrl + X`

```bash
# Copiar a la carpeta de Nginx
sudo cp nginx-frontend.conf /etc/nginx/sites-available/bisesal-frontend

# Activarla
sudo ln -s /etc/nginx/sites-available/bisesal-frontend /etc/nginx/sites-enabled/

# Eliminar la configuraci√≥n por defecto
sudo rm /etc/nginx/sites-enabled/default

# Verificar que la configuraci√≥n est√° bien
sudo nginx -t
```

Debe decir: `syntax is ok` y `test is successful` ‚úÖ

```bash
# Reiniciar Nginx
sudo systemctl reload nginx
```

---

## 7. Activar los certificados de seguridad

Esto es necesario para que funcione con HTTPS (el candado verde en el navegador).

‚ö†Ô∏è **IMPORTANTE:** Antes de este paso, aseg√∫rate de que tus dominios ya apuntan al servidor.

```bash
# Obtener certificado para el API
sudo certbot --nginx -d api.tu-institucion.gob.hn

# Obtener certificado para el Dashboard
sudo certbot --nginx -d dashboard.tu-institucion.gob.hn
```

Certbot te har√° algunas preguntas:
- **Email:** Escribe tu email
- **T√©rminos:** `A` (Aceptar)
- **¬øCompartir email?** `N` (No)
- **¬øRedirigir HTTP a HTTPS?** `2` (S√≠, redirigir)

Los certificados se renovar√°n autom√°ticamente cada 90 d√≠as. ‚úÖ

---

## 8. Verificar que todo funciona

### Verificaci√≥n 1: Backend funcionando ‚úÖ

```bash
curl http://localhost:4000/salud
```

Debe responder:
```json
{"estado":"ok","servicio":"bi-backend","ambiente":"production"}
```

### Verificaci√≥n 2: Dashboard accesible ‚úÖ

Abre tu navegador y visita:
```
https://dashboard.tu-institucion.gob.hn
```

Debes ver el tablero con las m√©tricas y el mapa. ‚úÖ

### Verificaci√≥n 3: API accesible ‚úÖ

En el navegador visita:
```
https://api.tu-institucion.gob.hn/salud
```

Debe mostrar el mismo JSON del paso anterior.

### Verificaci√≥n 4: Certificados SSL funcionando ‚úÖ

En el navegador, junto a la URL del dashboard, debe aparecer un **candado verde** üîí

---

## üéØ ¬°Sistema Instalado!

Tu sistema ahora est√° funcionando con:

‚úÖ Base de datos MySQL con todos tus datos  
‚úÖ Backend procesando peticiones 24/7  
‚úÖ Dashboard visual accesible desde cualquier navegador  
‚úÖ Certificados de seguridad (HTTPS) activados  
‚úÖ Sistema reinici√°ndose autom√°ticamente si hay problemas  

### üìä Caracter√≠sticas disponibles:

- **Tablero principal** con m√©tricas y estad√≠sticas
- **Mapa interactivo** de Honduras con datos por departamento
- **Tabla din√°mica** (Pivot) para crear reportes personalizados
- **Exportaci√≥n** a Excel y PDF
- **Modo claro y oscuro**
- **Compartir dashboards** mediante c√≥digo iframe para incrustar en otros sitios

---

## üîß Comandos √∫tiles para el administrador

### Ver si el sistema est√° funcionando:
```bash
pm2 status
```

### Ver los logs (errores o actividad):
```bash
pm2 logs bisesal-backend
```

### Reiniciar el sistema:
```bash
pm2 restart bisesal-backend
```

### Ver logs de Nginx:
```bash
# Logs del dashboard
sudo tail -f /var/log/nginx/bisesal-frontend-error.log

# Logs del API
sudo tail -f /var/log/nginx/bisesal-backend-error.log
```

### Reiniciar Nginx:
```bash
sudo systemctl reload nginx
```

---

## üì§ Compartir el Dashboard (Embeddings)

El sistema puede ser compartido en otros sitios web. Para hacerlo:

1. **Entra al dashboard** en tu navegador
2. **Clic en el bot√≥n "Compartir"** (arriba a la derecha)
3. **Elige el tama√±o** que quieras:
   - Peque√±o (800px x 600px)
   - Mediano (1200px x 800px)
   - Grande (100% x 1000px)
4. **Copia el c√≥digo** que aparece
5. **Pega el c√≥digo** en cualquier p√°gina HTML

Ejemplo de c√≥digo que puedes compartir:
```html
<iframe 
  src="https://dashboard.tu-institucion.gob.hn" 
  width="1200" 
  height="800" 
  frameborder="0" 
  allowfullscreen>
</iframe>
```

Esto permite incrustar el dashboard en:
- Sitios web gubernamentales
- Portales de transparencia
- Sistemas internos
- Presentaciones

---

## üÜò Soluci√≥n de Problemas

### ‚ùå El backend no inicia
**Soluci√≥n:**
```bash
# Ver qu√© est√° pasando
pm2 logs bisesal-backend --lines 50

# Verificar que la contrase√±a de MySQL es correcta
nano /var/www/bisesal/backend/.env
```

### ‚ùå No puedo acceder al dashboard
**Soluci√≥n:**
```bash
# Verificar que Nginx est√° corriendo
sudo systemctl status nginx

# Ver errores de Nginx
sudo tail -50 /var/log/nginx/bisesal-frontend-error.log
```

### ‚ùå Error de base de datos
**Soluci√≥n:**
```bash
# Verificar que MySQL est√° corriendo
sudo systemctl status mysql

# Probar conexi√≥n manual
mysql -u bisesal_user -p sesal_historico
```

### ‚ùå No funciona el certificado SSL
**Soluci√≥n:**
```bash
# Renovar certificados manualmente
sudo certbot renew

# Ver estado de los certificados
sudo certbot certificates
```

---

## üìû Informaci√≥n del Sistema

**Nombre:** BI SESAL - Business Intelligence  
**Versi√≥n:** 1.0.0  
**Tecnolog√≠as:** Node.js, MySQL, Vue.js, Nginx  
**Plataforma:** Linux (Ubuntu 22.04+)  

### Ubicaciones de archivos en el servidor:
- **Sistema:** `/var/www/bisesal/`
- **Logs del backend:** `/var/www/bisesal/backend/logs/`
- **Logs de Nginx:** `/var/log/nginx/`
- **Configuraci√≥n de Nginx:** `/etc/nginx/sites-available/`

---

## ‚úÖ Checklist Final

Marca cada punto al completarlo:

```
PREPARACI√ìN:
‚òê Servidor Linux instalado
‚òê Dominios configurados en DNS
‚òê Acceso SSH funcionando

INSTALACI√ìN SOFTWARE:
‚òê MySQL instalado y configurado
‚òê Node.js 20 instalado
‚òê PM2 instalado
‚òê Nginx instalado
‚òê Certbot instalado

BASE DE DATOS:
‚òê Base de datos creada
‚òê Usuario creado
‚òê Datos importados

SISTEMA:
‚òê C√≥digo descomprimido en /var/www/bisesal
‚òê Backend configurado (.env creado)
‚òê Backend corriendo con PM2
‚òê Frontend compilado (npm run build)
‚òê Frontend configurado (.env.production)

NGINX:
‚òê Configuraci√≥n del API activada
‚òê Configuraci√≥n del dashboard activada
‚òê Dominios cambiados en archivos
‚òê Nginx reiniciado

SEGURIDAD:
‚òê Certificado SSL del API instalado
‚òê Certificado SSL del dashboard instalado
‚òê HTTPS funcionando (candado verde)

VERIFICACI√ìN:
‚òê Backend responde en /salud
‚òê Dashboard carga en navegador
‚òê Datos aparecen correctamente
‚òê Embeddings funcionan
```

---

**¬°Felicidades! El sistema est√° completamente instalado y funcionando.** üéâ

Si tienes problemas, revisa la secci√≥n "Soluci√≥n de Problemas" o consulta los logs del sistema.

